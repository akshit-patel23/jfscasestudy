<div class="container">
  <div class="header-section">
    <h2>Manage Orders</h2>
    <div class="filter-section">
      <select [(ngModel)]="activeFilter" (change)="applyFilter()" class="form-select">
        <option *ngFor="let filter of filters" [value]="filter.value">
          {{ filter.label }}
        </option>
      </select>
    </div>
  </div>

  <div *ngIf="loading" class="text-center p-4">Loading orders...</div>

  <div *ngIf="!loading && filteredOrders.length === 0" class="text-center p-4">No orders found.</div>

  <table *ngIf="!loading && filteredOrders.length > 0" class="table table-bordered table-striped">
    <thead class="table-dark">
      <tr>
        <th>Order ID</th>
        <th>User Email</th>
        <th>Car Number</th>
        <th>Package</th>
        <th>Add-Ons</th>
        <th>Date</th>
        <th>Time</th>
        <th>Location</th>
        <th>Amount (₹)</th>
        <th *ngIf="activeFilter === 'pending'">Action</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let order of filteredOrders">
        <td>{{ order.orderId }}</td>
        <td>{{ order.userMail }}</td>
        <td>{{ order.carNumber }}</td>
        <td>{{ order.packageName }}</td>
        <td>{{ order.addOns.join(', ') }}</td>
        <td>{{ order.date }}</td>
        <td>{{ order.time }}</td>
        <td>{{ order.location }}</td>
        <td>{{ order.amount }}</td>
        <!-- <td>
          <span [ngClass]="{
            'text-success': order.status === 'completed',
            'text-warning': order.status === 'pending',
            'text-info': order.status === 'assigned'
          }">{{ order.status?.toUpperCase() || 'PENDING' }}</span>
        </td> -->
        <td *ngIf="activeFilter === 'pending'">
          <button (click)="openAssignModal(order)" class="btn btn-success btn-sm">
            Assign Washer
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Assign Washer Modal -->
<div *ngIf="showModal" class="modal-overlay" (click)="closeModal()">
  <div class="modal-dialog modal-lg">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h5 class="modal-title">Assign Washer</h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>
      <div class="modal-body">
        <div class="order-details mb-4">
          <h6 class="mb-3">Order Details</h6>
          <div class="row">
            <div class="col-md-6 mb-2">
              <strong>Order ID:</strong> {{ selectedOrder?.orderId }}
            </div>
            <div class="col-md-6 mb-2">
              <strong>User Email:</strong> {{ selectedOrder?.userMail }}
            </div>
            <div class="col-md-6 mb-2">
              <strong>Car Number:</strong> {{ selectedOrder?.carNumber }}
            </div>
            <div class="col-md-6 mb-2">
              <strong>Package:</strong> {{ selectedOrder?.packageName }}
            </div>
            <div class="col-md-6 mb-2">
              <strong>Add-Ons:</strong> {{ selectedOrder?.addOns?.join(', ') || 'None' }}
            </div>
            <div class="col-md-6 mb-2">
              <strong>Date:</strong> {{ selectedOrder?.date }}
            </div>
            <div class="col-md-6 mb-2">
              <strong>Time:</strong> {{ selectedOrder?.time }}
            </div>
            <div class="col-md-6 mb-2">
              <strong>Location:</strong> {{ selectedOrder?.location }}
            </div>
            <div class="col-md-6 mb-2">
              <strong>Amount:</strong> ₹{{ selectedOrder?.amount }}
            </div>
            <div class="col-12 mb-2" *ngIf="selectedOrder?.notes">
              <strong>Notes:</strong> {{ selectedOrder?.notes }}
            </div>
          </div>
        </div>
        <div class="washer-selection">
          <label for="washer-select" class="form-label">Select Washer:</label>
          <select id="washer-select" [(ngModel)]="selectedWasherId" class="form-select">
            <option value="">-- Select Washer --</option>
            <option *ngFor="let washer of availableWashers" [value]="washer.id">
              {{ washer.name }}
            </option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancel</button>
        <button
          type="button"
          class="btn btn-success"
          (click)="confirmAssignment()"
          [disabled]="!selectedWasherId">
          Assign Washer
        </button>
      </div>
    </div>
  </div>
</div>
